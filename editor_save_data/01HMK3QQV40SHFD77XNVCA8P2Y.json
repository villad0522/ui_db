[{"functionId":"test","functionNameJP":"テストコード","functionNameEN":"test","beforeCode":"","innerCode":"\n  await startUp(\"http://localhost:3000/\", true);\n  //\n  const { tableId: tableId1 } = await createTable(\"学年\");\n  const { columnId: columnId1 } = await createColumn( tableId1, \"学年\", \"INTEGER\", null );\n  await setTitleColumn( columnId1 );\n  await createRecord( tableId1, {\n    [columnId1]: 1,\n  });\n  await createRecord( tableId1, {\n    [columnId1]: 2,\n  });\n  await createRecord( tableId1, {\n    [columnId1]: 3,\n  });\n  //\n  const { tableId: tableId2 } = await createTable(\"名簿\");\n  const { columnId: columnId2  } = await createColumn( tableId2, \"学年\", \"POINTER\", tableId1 );\n  const { columnId: columnId3  } = await createColumn( tableId2, \"氏名\", \"TEXT\", null );\n  const { recordId: recordId } = await createRecord( tableId2, {\n    [columnId2+\"_text\"]: \"3\",\n    [columnId3]: \"田中太郎\",\n  });\n  //\n  const { sql, parameters } = await generateSQL(\n    tableId2,\n    [\n      {\n        displayColumnId: \"d1\",\n        type: \"RAW\",\n        path: `main.${columnId2} > ${columnId1}`,\n        as: \"学年\",\n      },\n      {\n        displayColumnId: \"d2\",\n        type: \"RAW\",\n        path: `main.${columnId3}`,\n        as: \"氏名\",\n      },\n    ],\n    [],\n    []\n  );\n  const matrix = await runSqlReadOnly(sql,parameters);\n  if( matrix.length !== 1 ){\n    throw \"テスト結果が想定とは異なります。\";\n  }\n  if( matrix[0]['学年'] !== 3 ){\n    throw \"テスト結果が想定とは異なります。\";\n  }\n  if( matrix[0]['氏名'] !== \"田中太郎\" ){\n    throw \"テスト結果が想定とは異なります。\";\n  }\n  await updateRecord( tableId2, [\n    {\n      \"id\": recordId,\n      [columnId2+\"_text\"]: \"2\",\n      [columnId3]: \"佐藤太郎\",\n    }\n  ]);\n  const matrix3 = await runSqlReadOnly(sql,parameters);\n  if( matrix3.length !== 1 ){\n    throw \"テスト結果が想定とは異なります。\";\n  }\n  if( matrix3[0]['学年'] !== 2 ){\n    throw \"テスト結果が想定とは異なります。\";\n  }\n  if( matrix3[0]['氏名'] !== \"佐藤太郎\" ){\n    throw \"テスト結果が想定とは異なります。\";\n  }\n  const { sql: sql2, parameters: parameters2 } = await generateSQL(\n    tableId1,\n    [\n      {\n        displayColumnId: \"d1\",\n        type: \"RAW\",\n        path: `main.${columnId1}`,\n        as: \"学年\",\n      },\n      {\n        displayColumnId: \"d2\",\n        type: \"COUNT\",\n        path: `${columnId2} > main`,\n        as: \"人数\",\n      },\n    ],\n    [],\n    []\n  );\n  const matrix2 = await runSqlReadOnly( sql2, parameters2 );\n  console.log(matrix2);\n  await close();\n","afterCode":"","parametersName":[],"parametersDataType":[],"returnValue":"void"},{"functionNameJP":"レコードを作成","functionNameEN":"createRecord","parametersName":["tableId","recordData"],"parametersDataType":["string",{"string":"any"}],"returnValue":{"recordId":"number","message":"string"},"functionId":"01HMK40WYDZHW5CNV7JESTGYTA","beforeCode":"\n\n\n","innerCode":"\n  const columns = await listColumnsAll( tableId );\n  const newRecordData = {};\n  for( const { id, name, dataType, parentTableId } of columns ){\n    if( dataType!==\"POINTER\" ){\n      newRecordData[id] = recordData[id];\n      continue;\n    }\n    if( !parentTableId ){\n      throw `親テーブルが不明です。\\nテーブルID=${tableId}\\nカラムID=${id}`;\n    }\n    const value = recordData[id];\n    const text = recordData[id+\"_text\"];\n    if( value && text ){\n      throw `レコードを追加しようとしましたが、リクエストが不正です。マスターデータのIDと文字列が両方指定されています。\\nテーブルID=${tableId}\\nカラムID=${id}`;\n    }\n    else if(value){\n      newRecordData[id] = recordData[id];\n      continue;\n    }\n    if(!text){\n      // 空欄の場合\n      continue;\n    }\n    // 文字列でマスターデータを指定された場合\n    if( typeof text !== \"string\" ){\n      throw `レコードを追加しようとしましたが、リクエストが不正です。「${id}_text」に文字列以外が指定されました。`;\n    }\n    const parentRecordId = await getRecordIdFromTitle( parentTableId, text );\n    if(!parentRecordId){\n      const parentTableName = await getTableName(parentTableId);\n      throw `「${text}」は「${parentTableName}」に登録されていません。`;\n    }\n    newRecordData[id] = parentRecordId;\n  }\n  return await createRecord( tableId, newRecordData );  // 下層の関数を呼び出す\n","afterCode":""},{"functionNameJP":"レコードを上書き","functionNameEN":"updateRecord","parametersName":["tableId","records"],"parametersDataType":["string",[{"string":"any"}]],"returnValue":"string","functionId":"01HMK43R2NJE49BF0QZE6GB15P","beforeCode":"\n\n\n","innerCode":"\n  const columns = await listColumnsAll( tableId );\n  const newRecords = [];\n  for( let i=0; i<records.length; i++ ){\n    newRecords[i] = {\n      id: records[i][\"id\"],\n    };\n    for( const { id: columnId, name, dataType, parentTableId } of columns ){\n      if( dataType!==\"POINTER\" ){\n        newRecords[i][columnId] = records[i][columnId];\n        continue;\n      }\n      if( !parentTableId ){\n        throw `親テーブルが不明です。\\nテーブルID=${tableId}\\nカラムID=${columnId}`;\n      }\n      const value = records[i][columnId];\n      const text = records[i][columnId+\"_text\"];\n      if( value && text ){\n        throw `レコードを上書きしようとしましたが、リクエストが不正です。マスターデータのIDと文字列が両方指定されています。\\nテーブルID=${tableId}\\nカラムID=${columnId}`;\n      }\n      else if(value){\n        newRecords[i][columnId] = records[i][columnId];\n        continue;\n      }\n      if(!text){\n        // 空欄の場合\n        continue;\n      }\n      // 文字列でマスターデータを指定された場合\n      if( typeof text !== \"string\" ){\n        throw `レコードを上書きしようとしましたが、リクエストが不正です。「${columnId}_text」に文字列以外が指定されました。`;\n      }\n      const parentRecordId = await getRecordIdFromTitle( parentTableId, text );\n      if(!parentRecordId){\n        const parentTableName = await getTableName(parentTableId);\n        throw `「${text}」は「${parentTableName}」に登録されていません。`;\n      }\n      newRecords[i][columnId] = parentRecordId;\n    }\n  }\n  return await updateRecord( tableId, newRecords );  // 下層の関数を呼び出す\n","afterCode":""},{"functionNameJP":"フィールドを検証","functionNameEN":"checkField","parametersName":["columnId","value"],"parametersDataType":["string","any"],"returnValue":{"isOK":"boolean","message":"string"},"functionId":"01HMK46XC4QDWFR77YPAF296V0","beforeCode":"\n\n","innerCode":"\n  throw \"この関数は未実装です。\";\n","afterCode":""},{"functionNameJP":"レコードを検証","functionNameEN":"checkRecord","parametersName":["tableId","recordData"],"parametersDataType":["string",{"string":"any"}],"returnValue":{"isOK":"boolean","message":"string"},"functionId":"01HMK49BAT63QX6CX7Q1NPZDEM","beforeCode":"\n\n","innerCode":"\n  throw \"この関数は未実装です。\";\n","afterCode":""},{"functionNameJP":"SQLクエリを生成","functionNameEN":"generateSQL","parametersName":["tableId","displayColumns","conditions","sortOrder"],"parametersDataType":["string",[{"displayColumnId":"string","type":"string","path":"string","as":"string"}],[{"displayColumnId":"string","type":"string","value":"number"}],[{"displayColumnId":"string","isAscending":"boolean"}]],"returnValue":{"sql":"string","parameters":"any"},"functionId":"01HMK4CBMABZNY6J2SJ5P8XCCP","beforeCode":"\n\n","innerCode":"\n  return await generateSQL( tableId, displayColumns, conditions, sortOrder );\n","afterCode":""},{"functionNameJP":"予測変換","functionNameEN":"autoCorrect","parametersName":["tableId","columnId","inputText","conditions"],"parametersDataType":["string","string","string",{"string":"any"}],"returnValue":["string"],"functionId":"01HMK4E8Z7AQKGM6YQGRMGPYMK","beforeCode":"\n\n\n\n","innerCode":"\n  throw \"この関数は未実装です。\";\n","afterCode":"\n"}]